<div class="app-container" *ngIf="showNavigation && currentUser">
  <!-- Overlay Sidebar -->
  <aside class="sidebar" [class.open]="showSidebar">
    <div class="sidebar-header">
      <div class="logo">
        <div class="logo-icon">ðŸ“Š</div>
        <span class="logo-text" *ngIf="!sidebarCollapsed">Habit Tracker</span>
      </div>
      <button class="sidebar-toggle" (click)="toggleSidebar()" [title]="showSidebar ? 'Close' : 'Open'">
        <i class="pi" [ngClass]="showSidebar ? 'pi-times' : 'pi-bars'"></i>
      </button>
    </div>

    <nav class="sidebar-nav">
      <!-- Admin: Overview Section -->
      <div class="nav-group" *ngIf="isAdmin">
        <div class="nav-group-label" *ngIf="!sidebarCollapsed">Overview</div>
        <button 
          class="nav-link" 
          [class.active]="router.url.includes('/admin/dashboard')"
          (click)="navigateTo('/admin/dashboard')"
          [title]="sidebarCollapsed ? 'Dashboard' : ''">
          <i class="pi pi-home"></i>
          <span *ngIf="!sidebarCollapsed">Dashboard</span>
        </button>
        <button 
          class="nav-link" 
          [class.active]="router.url.includes('/admin/calendar')"
          (click)="navigateTo('/admin/calendar')"
          [title]="sidebarCollapsed ? 'Calendar' : ''">
          <i class="pi pi-calendar"></i>
          <span *ngIf="!sidebarCollapsed">Calendar</span>
        </button>
      </div>

      <!-- Admin: Management Section -->
      <div class="nav-group" *ngIf="isAdmin">
        <div class="nav-group-label" *ngIf="!sidebarCollapsed">Management</div>
        <button 
          class="nav-link" 
          [class.active]="router.url.includes('/admin/goals')"
          (click)="navigateTo('/admin/goals')"
          [title]="sidebarCollapsed ? 'Goals' : ''">
          <i class="pi pi-list"></i>
          <span *ngIf="!sidebarCollapsed">Goals</span>
        </button>
        <button 
          class="nav-link" 
          [class.active]="router.url.includes('/admin/notifications')"
          (click)="navigateTo('/admin/notifications')"
          [title]="sidebarCollapsed ? 'Notifications' : ''">
          <i class="pi pi-bell"></i>
          <span *ngIf="!sidebarCollapsed">Notifications</span>
        </button>
      </div>

      <!-- User: My Habits Section -->
      <div class="nav-group" *ngIf="!isAdmin">
        <div class="nav-group-label" *ngIf="!sidebarCollapsed">My Habits</div>
        <button 
          class="nav-link" 
          [class.active]="router.url.includes('/user/dashboard')"
          (click)="navigateTo('/user/dashboard')"
          [title]="sidebarCollapsed ? 'Dashboard' : ''">
          <i class="pi pi-home"></i>
          <span *ngIf="!sidebarCollapsed">Dashboard</span>
        </button>
        <button 
          class="nav-link" 
          [class.active]="router.url.includes('/user/calendar')"
          (click)="navigateTo('/user/calendar')"
          [title]="sidebarCollapsed ? 'Calendar' : ''">
          <i class="pi pi-calendar"></i>
          <span *ngIf="!sidebarCollapsed">Calendar</span>
        </button>
      </div>
    </nav>

    <div class="sidebar-footer">
      <div class="user-profile">
        <div class="user-avatar">{{ getUserInitials() }}</div>
        <div class="user-info" *ngIf="!sidebarCollapsed">
          <div class="user-name">{{ currentUser?.name }}</div>
          <div class="user-role">{{ isAdmin ? 'Admin' : 'User' }}</div>
        </div>
      </div>
      <button class="logout-btn" (click)="logout()" [title]="sidebarCollapsed ? 'Logout' : ''">
        <i class="pi pi-sign-out"></i>
        <span *ngIf="!sidebarCollapsed">Logout</span>
      </button>
    </div>
  </aside>

  <!-- Backdrop -->
  <div class="backdrop" *ngIf="showSidebar" (click)="closeSidebar()"></div>

  <!-- Main Content with Topbar -->
  <main class="main-content">
    <div class="topbar">
      <button class="icon-btn" (click)="toggleSidebar()" title="Menu">
        <i class="pi pi-bars"></i>
      </button>
      <div class="topbar-title">{{ isAdmin ? 'Admin' : 'User' }} Panel</div>
    </div>
    <div class="content-wrapper">
      <router-outlet></router-outlet>
    </div>
  </main>
</div>

<!-- Auth Pages (No Sidebar) -->
<div class="auth-container" *ngIf="!showNavigation || !currentUser">
  <router-outlet></router-outlet>
</div>
