<div class="calendar-container">
  <div class="calendar-header">
    <button class="btn-nav" (click)="previousMonth()">← Prev Month</button>
    <h2>{{ getMonthYearDisplay() }}</h2>
    <button class="btn-nav" (click)="nextMonth()">Next Month →</button>
    <button class="btn-today" (click)="goToToday()">Today</button>
  </div>

  <div class="loading-spinner" *ngIf="loading">
    <p>Loading calendar...</p>
  </div>

  <div class="calendar-grid-container card" *ngIf="!loading">
    <div class="calendar-grid">
      <!-- Day headers -->
      <div class="day-header" *ngFor="let dayName of dayNames">
        {{ dayName }}
      </div>

      <!-- Empty cells before first day of month -->
      <div class="day-empty" *ngFor="let _ of getEmptyDaysStart()"></div>

      <!-- Days of month -->
      <div 
        *ngFor="let dayData of monthDays"
        class="day-cell"
        [class.today]="isToday(dayData.date)"
        [class.selected]="isSelectedDate(dayData.date)"
        [ngClass]="getColorClass(dayData.color)"
        (click)="selectDay(dayData)"
      >
        <div class="day-number">{{ dayData.date.getDate() }}</div>
        <div class="day-percentage" *ngIf="dayData.totalTasks > 0">
          {{ dayData.percentage }}%
        </div>
        <div class="day-indicator" *ngIf="dayData.totalTasks > 0">
          <span class="indicator-dot" [ngClass]="getColorClass(dayData.color)"></span>
        </div>
        <div class="day-no-data" *ngIf="dayData.totalTasks === 0">--</div>
      </div>
    </div>
  </div>

  <div class="selected-day-details">
    <h3>{{ getSelectedDateDisplay() }}</h3>

    <div class="loading-spinner-small" *ngIf="selectedDayLoading">
      <p>Loading details...</p>
    </div>

    <div *ngIf="!selectedDayLoading">
      <div class="daily-summary" *ngIf="selectedDayGoals.length > 0">
        <h4>Daily Habits Completion:</h4>
        
        <div class="goal-completion-list">
          <div class="goal-item" *ngFor="let goalData of selectedDayGoals">
            <span class="status-icon">
              {{ goalData.completedTasks === goalData.totalTasks ? '✓' : '✗' }}
            </span>
            <span class="goal-name">{{ goalData.goal.name }}</span>
            <span class="task-count">({{ goalData.completedTasks }}/{{ goalData.totalTasks }} tasks)</span>
          </div>
        </div>

        <div class="overall-completion">
          <strong>Overall:</strong> 
          {{ getTotalCompletionForSelectedDay().completed }}/{{ getTotalCompletionForSelectedDay().total }} tasks completed 
          ({{ getTotalCompletionForSelectedDay().percentage }}%)
        </div>
      </div>

      <div class="empty-state" *ngIf="selectedDayGoals.length === 0">
        <p>No goals assigned yet.</p>
      </div>

      <div class="legend">
        <h4>Legend:</h4>
        <div class="legend-items">
          <div class="legend-item">
            <span class="legend-dot day-green"></span>
            <span>80-100% completed</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot day-yellow"></span>
            <span>60-79% completed</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot day-orange"></span>
            <span>40-59% completed</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot day-red"></span>
            <span>0-39% completed</span>
          </div>
          <div class="legend-item">
            <span class="legend-dot day-gray"></span>
            <span>No data</span>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
